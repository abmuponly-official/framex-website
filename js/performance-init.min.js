(function(){'use strict';const config={enableServiceWorker:true,enableLazyLoading:true,enableFontOptimization:true,enableWebVitals:true,enableMonitoring:true,debug:false};const modules=[{name:'Critical CSS',inline:true},{name:'Font Optimizer',path:'/js/font-optimizer.min.js',critical:true},{name:'Core Web Vitals',path:'/js/core-web-vitals.min.js',critical:true},{name:'Image Optimization',path:'/js/image-optimization.min.js',defer:true},{name:'Performance Monitor',path:'/js/performance-monitor.min.js',defer:true}];const injectCriticalCSS=()=>{const style=document.createElement('style');style.textContent=` body{opacity:0;transition:opacity 0.3s;}body.fonts-loaded{opacity:1;}.img-placeholder{background:#f0f0f0;position:relative;overflow:hidden;}.img-placeholder::before{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.3),transparent);animation:shimmer 1.5s infinite;}@keyframes shimmer{0%{transform:translateX(-100%);}100%{transform:translateX(100%);}}`;document.head.insertBefore(style,document.head.firstChild);};const loadModule=(module)=>{return new Promise((resolve,reject)=>{if(module.inline){resolve();return;}const script=document.createElement('script');script.src=module.path;if(module.defer){script.defer=true;}else if(module.async){script.async=true;}script.onload=()=>{if(config.debug){console.log(`✅ Loaded:${module.name}`);}resolve();};script.onerror=()=>{console.error(`❌ Failed to load:${module.name}`);reject(new Error(`Failed to load ${module.name}`));};document.head.appendChild(script);});};const registerServiceWorker=async()=>{if(!config.enableServiceWorker||!('serviceWorker' in navigator)){return;}try{const registration=await navigator.serviceWorker.register('/service-worker.js',{scope:'/'});if(config.debug){console.log('✅ Service Worker registered:',registration);}setInterval(()=>{registration.update();},60000);registration.addEventListener('updatefound',()=>{const newWorker=registration.installing;newWorker.addEventListener('statechange',()=>{if(newWorker.state==='activated'){if(window.confirm('New version available!Reload to update?')){window.location.reload();}}});});}catch(error){console.error('Service Worker registration failed:',error);}};const initialize=async()=>{if(window.performance&&window.performance.mark){window.performance.mark('performance-init-start');}injectCriticalCSS();const criticalModules=modules.filter(m=>m.critical);const deferredModules=modules.filter(m=>m.defer);try{await Promise.all(criticalModules.map(loadModule));if(config.enableFontOptimization&&window.FontOptimizer){window.FontOptimizer.init();}if(config.enableWebVitals&&window.CoreWebVitals){window.CoreWebVitals.init();}Promise.all(deferredModules.map(loadModule)).then(()=>{if(config.enableLazyLoading&&window.ImageOptimization){window.ImageOptimization.init();}if(config.enableMonitoring&&window.PerformanceMonitor){window.PerformanceMonitor.init();}});registerServiceWorker();if(window.performance&&window.performance.mark){window.performance.mark('performance-init-end');window.performance.measure('performance-init','performance-init-start','performance-init-end');if(config.debug){const measure=window.performance.getEntriesByName('performance-init')[0];console.log(`⚡ Performance modules initialized in ${measure.duration.toFixed(2)}ms`);}}}catch(error){console.error('Performance initialization failed:',error);document.body.classList.add('fonts-loaded');}};const prefetchResources=()=>{const links=document.querySelectorAll('a[href^="/"],a[href^="./"],a[href^="../"]');links.forEach(link=>{link.addEventListener('mouseenter',()=>{const href=link.getAttribute('href');if(href&&!document.querySelector(`link[rel="prefetch"][href="${href}"]`)){const prefetch=document.createElement('link');prefetch.rel='prefetch';prefetch.href=href;document.head.appendChild(prefetch);}},{once:true,passive:true});});};const adaptiveLoading=()=>{if(!('connection' in navigator))return;const connection=navigator.connection;const effectiveType=connection.effectiveType;if(effectiveType==='slow-2g'||effectiveType==='2g'){config.enableLazyLoading=true;config.enableMonitoring=false;document.documentElement.classList.add('slow-connection');}else if(effectiveType==='3g'){document.documentElement.classList.add('medium-connection');}else{document.documentElement.classList.add('fast-connection');if(document.readyState==='complete'){prefetchResources();}else{window.addEventListener('load',prefetchResources);}}connection.addEventListener('change',adaptiveLoading);};const handleBFCache=()=>{window.addEventListener('pageshow',(event)=>{if(event.persisted){if(config.debug){console.log('Page restored from bfcache');}if(window.PerformanceMonitor){window.PerformanceMonitor.mark('bfcache-restore');}}});window.addEventListener('pagehide',(event)=>{if(event.persisted){if(config.debug){console.log('Page being cached to bfcache');}}});};const safeExecute=(fn,fallback)=>{try{return fn();}catch(error){console.error('Performance optimization error:',error);if(fallback)fallback();}};safeExecute(()=>{adaptiveLoading();handleBFCache();if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',initialize);}else{initialize();}window.addEventListener('load',()=>{setTimeout(()=>{if(window.performance&&window.performance.clearMarks){window.performance.clearMarks();window.performance.clearMeasures();}},5000);});},()=>{document.body.style.opacity='1';});if(config.debug){window.FrameXPerformance={config,modules,reinitialize:initialize};}})();