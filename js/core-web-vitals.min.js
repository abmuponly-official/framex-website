(function(){'use strict';const thresholds={LCP:{good:2500,poor:4000},FID:{good:100,poor:300},CLS:{good:0.1,poor:0.25},FCP:{good:1800,poor:3000},TTFB:{good:800,poor:1800}};const metrics={LCP:null,FID:null,CLS:null,FCP:null,TTFB:null,INP:null,navigationTiming:{}};const optimizations={optimizeLCP(){const heroImage=document.querySelector('.hero img,.hero-section img,[data-hero]');if(heroImage&&heroImage.src){const link=document.createElement('link');link.rel='preload';link.as='image';link.href=heroImage.src;link.fetchPriority='high';document.head.appendChild(link);}const criticalStyles=document.querySelector('link[href*="critical"]');if(criticalStyles){criticalStyles.rel='preload';criticalStyles.as='style';criticalStyles.onload=function(){this.rel='stylesheet';};}document.querySelectorAll('link[rel="stylesheet"]').forEach(link=>{if(!link.href.includes('critical')){link.media='print';link.onload=function(){this.media='all';};}});document.querySelectorAll('video').forEach(video=>{video.preload='metadata';if(!video.hasAttribute('playsinline')){video.setAttribute('playsinline','');}});},optimizeFID(){const yieldToMain=()=>{return new Promise(resolve=>{setTimeout(resolve,0);});};document.querySelectorAll('script:not([async]):not([defer])').forEach(script=>{if(!script.src.includes('critical')&&!script.src.includes('main')){script.defer=true;}});const passiveEvents=['touchstart','touchmove','wheel','scroll'];passiveEvents.forEach(eventType=>{window.addEventListener(eventType,()=>{},{passive:true});});let inputTimer;const optimizeInput=(callback,delay=50)=>{clearTimeout(inputTimer);inputTimer=setTimeout(callback,delay);};document.querySelectorAll('input,textarea,select').forEach(element=>{element.addEventListener('input',(e)=>{optimizeInput(()=>{element.dispatchEvent(new CustomEvent('optimizedInput',{detail:{value:e.target.value}}));});});});if(window.Worker){window.runInWorker=(fn,args)=>{return new Promise((resolve,reject)=>{const blob=new Blob([` self.onmessage=function(e){const fn=${fn.toString()};const result=fn(...e.data);self.postMessage(result);}`],{type:'application/javascript'});const worker=new Worker(URL.createObjectURL(blob));worker.onmessage=(e)=>{resolve(e.data);worker.terminate();};worker.onerror=reject;worker.postMessage(args);});};}},optimizeCLS(){document.querySelectorAll('img:not([width])').forEach(img=>{if(img.naturalWidth&&img.naturalHeight){img.width=img.naturalWidth;img.height=img.naturalHeight;}});document.querySelectorAll('img,video,iframe').forEach(element=>{const width=element.getAttribute('width');const height=element.getAttribute('height');if(width&&height&&!element.style.aspectRatio){element.style.aspectRatio=`${width}/${height}`;}});const reserveSpace=(selector,minHeight)=>{const elements=document.querySelectorAll(selector);elements.forEach(el=>{if(!el.style.minHeight){el.style.minHeight=minHeight+'px';}});};reserveSpace('.ad-container',250);reserveSpace('.social-embed',350);reserveSpace('.dynamic-content',200);document.documentElement.style.fontDisplay='optional';const animations=document.querySelectorAll('[data-animate],.animate');animations.forEach(element=>{element.style.willChange='transform';element.style.transform='translateZ(0)';});const observer=new MutationObserver((mutations)=>{mutations.forEach(mutation=>{if(mutation.type==='childList'){mutation.addedNodes.forEach(node=>{if(node.nodeType===1){if(node.tagName==='IMG'){node.loading='lazy';node.decoding='async';}if(node.classList&&node.classList.contains('container')){node.style.contain='layout';}}});}});});observer.observe(document.body,{childList:true,subtree:true});},optimizeTTFB(){const addResourceHint=(rel,href)=>{const link=document.createElement('link');link.rel=rel;link.href=href;if(rel==='preconnect'){link.crossOrigin='anonymous';}document.head.appendChild(link);};const thirdPartyDomains=['https://fonts.googleapis.com','https://fonts.gstatic.com','https://www.google-analytics.com','https://www.googletagmanager.com'];thirdPartyDomains.forEach(domain=>{addResourceHint('dns-prefetch',domain);addResourceHint('preconnect',domain);});if('connection' in navigator){const connection=navigator.connection;if(connection.effectiveType==='4g'){document.querySelectorAll('link[data-preload-4g]').forEach(link=>{link.rel='preload';});}else if(connection.effectiveType==='slow-2g'||connection.effectiveType==='2g'){document.querySelectorAll('img[data-optional]').forEach(img=>{img.loading='lazy';img.decoding='async';});}}},applyPriorityHints(){document.querySelectorAll('[data-priority="high"]').forEach(element=>{element.fetchPriority='high';});document.querySelectorAll('[data-priority="low"]').forEach(element=>{element.fetchPriority='low';});const viewportHeight=window.innerHeight;document.querySelectorAll('img').forEach(img=>{const rect=img.getBoundingClientRect();if(rect.top<viewportHeight){img.fetchPriority='high';}else if(rect.top<viewportHeight*2){img.fetchPriority='auto';}else{img.fetchPriority='low';}});}};const measureVitals=()=>{if('PerformanceObserver' in window){try{const lcpObserver=new PerformanceObserver((list)=>{const entries=list.getEntries();const lastEntry=entries[entries.length-1];metrics.LCP=lastEntry.renderTime||lastEntry.loadTime;reportMetric('LCP',metrics.LCP);});lcpObserver.observe({type:'largest-contentful-paint',buffered:true});}catch(e){console.error('LCP measurement failed:',e);}try{const fidObserver=new PerformanceObserver((list)=>{const entries=list.getEntries();entries.forEach(entry=>{if(!metrics.FID){metrics.FID=entry.processingStart-entry.startTime;reportMetric('FID',metrics.FID);}});});fidObserver.observe({type:'first-input',buffered:true});}catch(e){console.error('FID measurement failed:',e);}let clsValue=0;let clsEntries=[];try{const clsObserver=new PerformanceObserver((list)=>{for(const entry of list.getEntries()){if(!entry.hadRecentInput){const firstSessionEntry=clsEntries[0];const lastSessionEntry=clsEntries[clsEntries.length-1];if(entry.startTime-lastSessionEntry.startTime<1000&&entry.startTime-firstSessionEntry.startTime<5000){clsEntries.push(entry);clsValue+=entry.value;}else{clsEntries=[entry];clsValue=entry.value;}metrics.CLS=clsValue;reportMetric('CLS',metrics.CLS);}}});clsObserver.observe({type:'layout-shift',buffered:true});}catch(e){console.error('CLS measurement failed:',e);}}if('performance' in window&&'getEntriesByType' in performance){const navigationEntry=performance.getEntriesByType('navigation')[0];if(navigationEntry){metrics.TTFB=navigationEntry.responseStart-navigationEntry.fetchStart;reportMetric('TTFB',metrics.TTFB);}const paintEntries=performance.getEntriesByType('paint');paintEntries.forEach(entry=>{if(entry.name==='first-contentful-paint'){metrics.FCP=entry.startTime;reportMetric('FCP',metrics.FCP);}});}};const reportMetric=(name,value)=>{const rating=getMetricRating(name,value);console.log(`[Web Vitals]${name}:${value.toFixed(2)}ms(${rating})`);if(window.gtag){gtag('event','web_vitals',{event_category:'Web Vitals',event_label:name,value:Math.round(value),metric_rating:rating,non_interaction:true});}window.dispatchEvent(new CustomEvent('web-vital-measured',{detail:{metric:name,value,rating}}));};const getMetricRating=(name,value)=>{const threshold=thresholds[name];if(!threshold)return 'unknown';if(value<=threshold.good)return 'good';if(value<=threshold.poor)return 'needs-improvement';return 'poor';};const init=()=>{optimizations.optimizeLCP();optimizations.optimizeFID();optimizations.optimizeCLS();optimizations.optimizeTTFB();optimizations.applyPriorityHints();measureVitals();window.addEventListener('load',()=>{setTimeout(()=>{optimizations.applyPriorityHints();},1000);});};window.CoreWebVitals={init,metrics,thresholds,optimize:optimizations,measure:measureVitals,getMetricRating};if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',init);}else{init();}})();